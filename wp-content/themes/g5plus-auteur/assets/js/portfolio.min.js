var G5_Portfolio=window.G5_Portfolio||{};(function(a){'use strict';window.G5_Portfolio=G5_Portfolio;var b=a(window),c=a('body'),d=c.hasClass('gf-lazy-load'),f=c.hasClass('rtl');G5_Portfolio={ajax_call:!1,cache:{group:'portfolio_gallery'},init:function(){this.light_box_gallery();var g=a('.gallery-layout-thumbnail');g.length&&this.single_portfolio_gallery(g),this.initJustifiedLayout(),this.updateAjaxSuccess()},get_gallery_cache_key:function(g){return'portfolio_gallery_'+g},light_box_gallery:function(){var g=this;a(document).on('click','[data-portfolio-gallery]',function(h){if(h.preventDefault(),!1===g.ajax_call){var i=a(this),j=i.closest('.portfolio-item-inner').addClass('active'),k=parseInt(i.data('id'),10),l=g.get_gallery_cache_key(k);i.append('<i class="fa fa-spinner fa-pulse"></i>');var m=G5_Core.cache.getCache(l,g.cache.group);''===m?g.ajax_call=a.ajax({url:g5plus_variable.ajax_url,data:{action:'portfolio_gallery',id:k},success:function(n){g.ajax_call=!1,i.html(''),n.success&&(G5_Core.cache.addCache(l,n.data,g.cache.group),g.show_popup_gallery(n.data),setTimeout(function(){j.removeClass('active')},200))},error:function(n){console.log(n),setTimeout(function(){j.removeClass('active')},200)}}):(g.show_popup_gallery(m),i.html(''),g.ajax_call=!1,setTimeout(function(){j.removeClass('active')},200))}})},show_popup_gallery:function(g){var h='video'===g.type?'iframe':'image';a.magnificPopup.open({type:h,mainClass:'mfp-zoom-in',midClick:!0,removalDelay:500,items:g.items,gallery:{enabled:!0},callbacks:{beforeOpen:function(){switch(this.st.type){case'image':this.st.image.markup=this.st.image.markup.replace('mfp-figure','mfp-figure mfp-with-anim');break;case'iframe':this.st.iframe.markup=this.st.iframe.markup.replace('mfp-iframe-scaler','mfp-iframe-scaler mfp-with-anim');}},change:function(){var i=this;this.isOpen&&(this.wrap.removeClass('mfp-ready'),setTimeout(function(){i.wrap.addClass('mfp-ready')},10))}}})},single_portfolio_gallery:function(g){var i=g.find('.single-portfolio-gallery-main'),j=g.find('.single-portfolio-gallery-thumb');i.owlCarousel({items:1,nav:!1,dots:!1,loop:!1,rtl:f,lazyLoad:d}).on('changed.owl.carousel',function(k){var l=k.item.index;j.find('.owl-item').removeClass('current').eq(l).addClass('current');var m=j.find('.owl-item.active').length-1,n=j.find('.owl-item.active').first().index(),o=j.find('.owl-item.active').last().index();l>o&&j.data('owl.carousel').to(l,100,!0),l<n&&j.data('owl.carousel').to(l-m,100,!0)}),j.on('initialized.owl.carousel',function(){j.find('.owl-item').eq(0).addClass('current')}).owlCarousel({items:4,nav:!1,dots:!1,rtl:f,lazyLoad:d,margin:10,responsive:{992:{items:4},768:{items:3},0:{items:2}}}),j.on('click','.owl-item',function(k){if(k.preventDefault(),!a(this).hasClass('current')){var l=a(this).index();i.data('owl.carousel').to(l,300,!0)}}),a(document).on('reset_data',function(){i.data('owl.carousel').to(0,300,!0)})},initJustifiedLayout:function(g){'undefined'==typeof g&&(g=a('body')),a('.layout-justified',g).each(function(){var h=a(this),i=h.data('justified-options'),j=i.row_height,k=i.row_max_height,l=i.margin;h.hasClass('justified-init')||h.imagesLoaded({background:!0},function(){h.justifiedGallery({rowHeight:j,maxRowHeight:k,waitThumbnailsLoad:!1,selector:'article.portfolio-grid',margins:l,lastRow:'justify',cssAnimation:!0}).on('jg.complete',function(){h.addClass('justified-init'),a('article.portfolio-grid',h).each(function(){var m='';m=0===a('.entry-thumbnail-overlay',a(this)).length?a('.portfolio-item-inner',a(this)):a('.entry-thumbnail-overlay',a(this));var n=a(this).height();m.css('height',n+'px')})}).on('jg.resize',function(){a('article.portfolio-grid',h).each(function(){var m='';m=0===a('.entry-thumbnail-overlay',a(this)).length?a('.portfolio-item-inner',a(this)):a('.entry-thumbnail-overlay',a(this));var n=a(this).height();m.css('height',n+'px')})})})})},updateAjaxSuccess:function(){this;c.on('gf_pagination_ajax_success',function(h,i,j,k){'portfolio'===i.settings.post_type&&(a(h.target).imagesLoaded({background:!0},function(){a('.layout-justified',c).each(function(){a(this).removeClass('justified-init')}),setTimeout(function(){G5_Portfolio.initJustifiedLayout()},500)}),G5_Core.pagination_ajax.updatePageTitle(i,j,k),G5_Core.pagination_ajax.updateSideBar(i,j,k))})}},a(document).ready(function(){G5_Portfolio.init()})})(jQuery);